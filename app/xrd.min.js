(()=>{var nt=Object.create;var ue=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var it=Object.getOwnPropertyNames;var ot=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var at=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var ct=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of it(e))!st.call(n,i)&&i!==t&&ue(n,i,{get:()=>e[i],enumerable:!(r=rt(e,i))||r.enumerable});return n};var ut=(n,e,t)=>(t=n!=null?nt(ot(n)):{},ct(e||!n||!n.__esModule?ue(t,"default",{value:n,enumerable:!0}):t,n));var be=at((jt,V)=>{"use strict";var T=typeof Reflect=="object"?Reflect:null,le=T&&typeof T.apply=="function"?T.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},N;T&&typeof T.ownKeys=="function"?N=T.ownKeys:Object.getOwnPropertySymbols?N=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:N=function(e){return Object.getOwnPropertyNames(e)};function lt(n){console&&console.warn&&console.warn(n)}var pe=Number.isNaN||function(e){return e!==e};function f(){f.init.call(this)}V.exports=f;V.exports.once=mt;f.EventEmitter=f;f.prototype._events=void 0;f.prototype._eventsCount=0;f.prototype._maxListeners=void 0;var fe=10;function I(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return fe},set:function(n){if(typeof n!="number"||n<0||pe(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");fe=n}});f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};f.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||pe(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ge(n){return n._maxListeners===void 0?f.defaultMaxListeners:n._maxListeners}f.prototype.getMaxListeners=function(){return ge(this)};f.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=e==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var c=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw c.context=s,c}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")le(u,this,t);else for(var d=u.length,a=we(u,d),r=0;r<d;++r)le(a[r],this,t);return!0};function me(n,e,t,r){var i,o,s;if(I(t),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),o=n._events),s=o[e]),s===void 0)s=o[e]=t,++n._eventsCount;else if(typeof s=="function"?s=o[e]=r?[t,s]:[s,t]:r?s.unshift(t):s.push(t),i=ge(n),i>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=n,c.type=e,c.count=s.length,lt(c)}return n}f.prototype.addListener=function(e,t){return me(this,e,t,!1)};f.prototype.on=f.prototype.addListener;f.prototype.prependListener=function(e,t){return me(this,e,t,!0)};function ft(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function he(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=ft.bind(r);return i.listener=t,r.wrapFn=i,i}f.prototype.once=function(e,t){return I(t),this.on(e,he(this,e,t)),this};f.prototype.prependOnceListener=function(e,t){return I(t),this.prependListener(e,he(this,e,t)),this};f.prototype.removeListener=function(e,t){var r,i,o,s,c;if(I(t),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){c=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():pt(r,o),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};f.prototype.off=f.prototype.removeListener;f.prototype.removeAllListeners=function(e){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function ve(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?gt(i):we(i,i.length)}f.prototype.listeners=function(e){return ve(this,e,!0)};f.prototype.rawListeners=function(e){return ve(this,e,!1)};f.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):ye.call(n,e)};f.prototype.listenerCount=ye;function ye(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?N(this._events):[]};function we(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function pt(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function gt(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function mt(n,e){return new Promise(function(t,r){function i(s){n.removeListener(e,o),r(s)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}Ee(n,e,o,{once:!0}),e!=="error"&&ht(n,i,{once:!0})})}function ht(n,e,t){typeof n.on=="function"&&Ee(n,"error",e,t)}function Ee(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function i(o){r.once&&n.removeEventListener(e,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}});var X=class{isArray(e){return Array.isArray(e)}assign(e,t){if(e==null)throw new TypeError("Cannot convert undefined or null to object.");let r=Object(e);for(let i=1;i<arguments.length;i++){let o=arguments[i];if(o!=null)for(let s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}return r}isObject(e){return e&&typeof e=="object"&&!this.isArray(e)&&e!==null}getDomain(e){let t=e.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);return typeof(t&&t[1])!="string"?"error":(t&&t[1]).split(".").reverse()[1]||t&&t[1]}getTime(){return Date.now?Date.now():new Date().getTime()}getCookie(e=null){if(!document.cookie)return{};let t={};return document.cookie.split(";").map(r=>{let i=window.unescape(r).trim().split("=");t[i[0]]=i[1]}),e?t.key:t}toArray(e){return this.isObject(e)?Object.keys(e).map(t=>({key:t,value:e[t]})):[e]}mergeDeep(e,t){let r=this.assign({},e);if(this.isObject(e)&&this.isObject(t)){let i={},o={};Object.keys(t).forEach(s=>{this.isObject(t[s])?s in e?r[s]=this.mergeDeep(e[s],t[s]):(i={},i[s]=t[s],this.assign(r,i)):(o={},o[s]=t[s],this.assign(r,o))})}return r}_addLoadEvent(e){let t=window.onload;typeof t!="function"?window.onload=e:window.onload=()=>{t&&t.call(window),e()}}ready(e){if(typeof window>"u")return e();window.addEventListener?window.addEventListener("load",e,!1):window.attachEvent?window.attachEvent("onload",e):window.onload?this._addLoadEvent(e):window.console.warn("did not identify any source of onload event.")}onError(e){if(typeof window>"u")return;let t=window.onerror;typeof t!="function"?window.onerror=e:window.onerror=(r,i,o,s,c)=>{t&&t(r,i,o,s,c),e(r,i,o,s,c)}}onPageHide(e){if(typeof window>"u")return;let t=window.onpagehide;typeof t!="function"?window.onpagehide=e:window.onpagehide=()=>{t&&t.call(window),e()}}addEventListener(e,t,r){e.addEventListener?e.addEventListener(t,r):e.attachEvent&&e.attachEvent(t,r)}triggerEvent(e,t,r,i=!0){let o=null;return typeof window<"u"&&window.CustomEvent?o=new CustomEvent(t,{bubbles:i,detail:r}):(o=document.createEvent("CustomEvent"),o.initCustomEvent(t,i,!0,r)),e.dispatchEvent(o)}jsonPostRequest(e,t,r){if(typeof XMLHttpRequest>"u")return r("XMLHttpRequest does not exist.");let i=new XMLHttpRequest;i.open("POST",e),i.setRequestHeader("Content-Type","application/json"),i.withCredentials=!0,i.onreadystatechange=o=>{i.readyState===4&&(i.status===200||i.status===201||i.status===202||i.status===204?r(null,{headers:{},status:i.status},i.responseText):r("Error: "+i.statusText))},i.send(JSON.stringify(t))}createCookie(e,t,r){let i;if(r){let o=new Date;o.setTime(o.getTime()+r*24*60*60*1e3),i=`; expires=${o.toUTCString()}`}else i="";document.cookie=`${e}=${t}${i}; path=/`}readCookie(e){let t=e+"=",r=document.cookie.split(";");for(let i of r){for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null}removeCookie(e){this.createCookie(e,"",-1)}};var g=new X;g.ready(()=>{if(typeof window>"u"||typeof window.Adform>"u")return;let n=window.Adform._uid;typeof n>"u"||!n||g.createCookie("_afid",n+"",7)});var dt=()=>{typeof window>"u"||window.addEventListener("loginRequired",()=>{window.location.href="/mydata/login"})};dt();var G=class{events={};on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}emit(e,t,r,i){if(!this.events[e])return;let o=this.events[e].length;for(let s=0;s<o;s++)this.events[e][s]&&typeof this.events[e][s]=="function"&&this.events[e][s](t,r,i)}del(e){if(!this.events[e]){window.console.warn(e+" does not exist as event, nothing to delete.");return}this.events[e]=null,delete this.events[e]}},de=G;var _e=ut(be());var W=!1,E=class extends _e.EventEmitter{_isXRDScope=!0;_tagManagerLoaded=!1;environment="";_PAGE_DATA_TOPIC="xrd-page-data";_CUSTOM_EVENT_TOPIC="xrd-custom-event";_PAGE_FINISH_TOPIC="finish";_DEFAULT_ENVIRONMENT="LOCAL";_ENDPOINT_PAGE_DATA_EVENT="/api/xrd/page-data/classic-event";_ENDPOINT_PAGE_DATA_LAYER="/api/xrd/page-data/data-layer";_DEFAULT_THRESHOLD=75;_BATCH_INTERVAL_MS=2e3;_DEFAULT_PAGE_DATA_BASIS={};_eventContainer=[];_SITE_NAME;_interval=null;_adblock=0;_adform=0;_pageData={};_ADOBE_LAUNCH_SRC_DEV="//assets.adobedtm.com/launch-EN84e067f7f08a4190b7a0845cbca9bbcd-development.min.js";_ADOBE_LAUNCH_SRC_STAGE="//assets.adobedtm.com/launch-ENaeefa5d018ad4a23b2a3ff3b983ea8d2-staging.min.js";_ADOBE_LAUNCH_SRC_PROD="//assets.adobedtm.com/launch-EN3bc461a78fce46f2b568b3b2b949fb68.min.js";_tmsLoadedListenerExists=!1;_trackingQueue=[];constructor(e=""){super(),this._SITE_NAME=e}static __isDnt(){let e=!0;return window.XRD&&window.XRD.trackingOptOut!==void 0&&(e=window.XRD.trackingOptOut===!0),e}_noop(){}__extendPageData(e){if(this._tagManagerLoaded){window.console.warn("tracking has already loaded tag manager snippet, your page data extend wont be added.");return}e&&e.page&&e.page.variant&&(this.addPageVariant(e.page.variant),e=Object.assign({},e),delete e.page.variant),this._setPageData(g.mergeDeep(this._pageData||this._DEFAULT_PAGE_DATA_BASIS,e))}__callCustomEvent(e,t){if(E.__isDnt())return;if(typeof document>"u"){this._logError("page event call requires document.");return}if(typeof e!="string"){this._logError("page event call should be a string.");return}let r=g.triggerEvent(document,e,t,!1);if(!this._eventContainer||!(this._eventContainer instanceof Array)){this._logError("event is called from bad scope");return}if(this._eventContainer.push({event:e,payload:t}),r)return this._log("Event: "+e+" emitted."),this.emit("event",e,t);this._logError("Event: "+e+" not emitted.")}_appendTagManager(){if(E.__isDnt())return;if(this._tagManagerLoaded){window.console.warn("_appendTagManager has already been called.");return}if(this._tagManagerLoaded=!0,typeof window<"u"&&window.BrightTag){window.console.warn("Tag Manager has already been loaded; remove bt-static sourcetags before using XRD.Tracking.");return}if(typeof window<"u"&&this._postPageData(),this._log("PageData. Object set, loading Tag Manager."),this.environment==="TEST")return;let e=[];switch(this.environment){case"INT":e.push(this._ADOBE_LAUNCH_SRC_DEV);break;case"PRE":e.push(this._ADOBE_LAUNCH_SRC_STAGE);break;case"PROD":e.push(this._ADOBE_LAUNCH_SRC_PROD);break;default:e.push(this._ADOBE_LAUNCH_SRC_PROD);break}performance.mark("add-adobe-launch-script"),e.forEach(t=>this.createAndLoadScript(t,!0)),performance.mark("adobe-launch-script-done"),performance.measure("adobe-launch-script-duration","add-adobe-launch-script","adobe-launch-script-done")}_getResources(e,t){if(e.length===0)return{};let r={};if(document){let a=["iframe","script","style","link"],l=0;Array.from(document.head.children).forEach(p=>{a.includes(p.localName)&&(r[p.src]={blocked:!0,tag:p.localName})}),Array.from(document.body.children).reverse().forEach((p,m)=>{let _=!1;p.localName==="div"&&(l=m),l>0&&(_=!0),a.includes(p.localName)&&(r[p.src]={blocked:!0,tag:p.localName})}),Array.from(document.body.getElementsByTagName("img")).forEach(p=>{a.includes(p.localName)&&(r[p.src]={blocked:!0,tag:p.localName})})}let i={},o={},s={},c=t.loadEventEnd-t.navigationStart||0,u=a=>{let l=g.getDomain(a.name),p=!1;if(!i[`${l}:${a.type}`])i[`${l}:${a.type}`]={},i[`${l}:${a.type}`].counts=1,i[`${l}:${a.type}`].duration=a.duration,i[`${l}:${a.type}`].size=a.encodedType||a.transferSize,i[`${l}:${a.type}`].start=a.startTime,i[`${l}:${a.type}`].end=a.responseEnd;else{let m=i[`${l}:${a.type}`];a.responseEnd<c&&(m.counts+=1,m.size+=a.encodedType||a.transferSize,m.start=a.start<m.start?a.start:m.start,m.end=a.end>m.end?a.end:m.end,m.duration+=a.duration)}return Object.keys(r).length>0&&(p=r[a.name]&&r[a.name].blocked||!1),{blocked:p,counts:i[`${l}:${a.type}`].counts,end:i[`${l}:${a.type}`].end,name:l,size:i[`${l}:${a.type}`].size,start:i[`${l}:${a.type}`].start,timeTotal:i[`${l}:${a.type}`].duration,type:a.initiatorType}},d=e.map(u).reverse().filter(a=>a.responseEnd<c&&o.hasOwnProperty(`${a.name}:${a.type}`)?!1:o[`${a.name}:${a.type}`]=!0);return d.length===0||c===0?{}:(d.forEach(a=>{s[`${a.name}_${a.type}`]={blocked:a.blocked,counts:a.counts,end:Number(a.end.toFixed(2)),size:Number((a.size/1024).toFixed(2)),start:Number(a.start.toFixed(2)),timeTotal:Number((a.timeTotal/1).toFixed(2))}}),s)}_postPageData(){let e={},t={},r=window.performance&&window.performance.timing||null,i=window.performance&&window.performance.getEntriesByType("navigation")||[],o=window.performance&&window.performance.getEntriesByType("resource")||[],s={domLoaded:r?r.domContentLoadedEventEnd-r.navigationStart:null,pageLoaded:r?r.loadEventEnd-r.navigationStart:null,ttfb:r?r.responseStart-r.requestStart:null};try{t=this._getResources(o,r),e={adblock:this._adblock,adform:this._adform,cookiesCount:g.toArray(g.getCookie()).length||null,requests:i.length+o.length||null,resources:t,size:i[0]&&Number((i[0].transferSize/1024).toFixed(2))||null,timing:s,xhrEntries:o.filter(u=>u.initiatorType==="xmlhttprequest").length||null}}catch{}let c=g.mergeDeep(this._pageData,{_performance:e});if(this.environment==="TEST"||this.environment==="LOCAL"){this._setPageData(c);return}this._submitData(this._ENDPOINT_PAGE_DATA_LAYER,c,this._noop)}_log(e){this.environment!=="PROD"&&window.console.log(`XRD: ${e}`)}_logError(e){this.environment!=="PROD"&&window.console.error("XRD:",e)}init(e=this._DEFAULT_ENVIRONMENT,t=this._DEFAULT_PAGE_DATA_BASIS){if(!this._isXRDScope){this._logError("you are calling XRD tracking actions from a bad scope.");return}if(typeof e!="string"){this._logError("tracking init environment should be a string.");return}if(e=e.toUpperCase(),["LOCAL","TEST","DEV","INT","PRE","PROD"].indexOf(e)===-1&&this._logError("tracking init with unknown environment: "+e),typeof t!="object"){this._logError("tracking init pageDataBasis should be an object.");return}this._initializeEvents(),this.environment=e,this._setPageData(t)}race(e=this._DEFAULT_THRESHOLD){if(!this._isXRDScope){this._logError("you are calling XRD tracking actions from a bad scope.");return}if(!this._pageData){this._logError("tracking race must not be called before init().");return}if(typeof e!="number"||e>2e3||e<10){this._logError("tracking race threshold should be a number (milliseconds) between 10 and 2000.");return}this._log("Ok. Race is on."),setTimeout(()=>{this.emit(this._PAGE_FINISH_TOPIC,this._pageData)},e)}getPageData(){return this._pageData}extendPageData(e){if(!this._isXRDScope){this._logError("you are calling XRD tracking actions from a bad scope.");return}if(typeof e!="object"){this._logError("extendPageData should only be called with a single parameter of type 'object'.");return}this.emit(this._PAGE_DATA_TOPIC,e)}addPageVariant(e){if(!this._pageData.page)return;let t=this._pageData.page.variant?this._pageData.page.variant.split(/ *, */):[];return t.indexOf(e)===-1&&t.push(e),this._pageData.page.variant=t.join(","),t}removePageVariant(e){if(!this._pageData.page)return;let t=this._pageData.page.variant?this._pageData.page.variant.split(/ *, */):[],r=t.indexOf(e);return r!==-1&&t.splice(r,1),this._pageData.page.variant=t.join(","),t}trackEvent(e,t){try{if(!this._isXRDScope){this._logError("you are calling XRD tracking actions from a bad scope.");return}if(E.__isDnt())return;window.tmsLoaded?this._trackEvent(e,t):this._queueTrackingEvent(e,t)}catch(r){let i=`An error occurred while sending the tracking event [${e}] and payload [${JSON.stringify(t)}] page via trackEvent() - ${r}`;document.dispatchEvent(new CustomEvent("xrd.log.error",{bubbles:!0,detail:{serviceName:"rewe-duc-base",message:i}}))}}customEvent(e,t){if(!this._isXRDScope){this._logError("you are calling XRD tracking actions from a bad scope.");return}if(typeof e!="string"&&this._logError("Please pass a valid event (as string) to XRD.Tracking."),!document){this._logError("Document does not exist");return}this.emit(this._CUSTOM_EVENT_TOPIC,e,t)}onEvent(e,t){if(!this._isXRDScope){this._logError("you are calling XRD tracking actions from a bad scope.");return}this.on(e,t)}startBatching(){this._interval===null&&(this._interval=setInterval(this.__flushEvents.bind(this),this._BATCH_INTERVAL_MS))}stopBatching(){this._interval!==null&&(clearInterval(this._interval),this._interval=null)}__flushEvents(){this._eventContainer&&this._eventContainer.length&&(this._eventContainer=[])}__registerGlobalHandlers(){g.onError(this.__flushEvents.bind(this)),g.onPageHide(this.__flushEvents.bind(this))}createAndLoadScript(e,t=!1){let r=document.createElement("script"),i=document.getElementsByTagName("script")[0];r.async=t,r.src=e,i.parentNode.insertBefore(r,i)}_setPageData(e){window.pageData=this._pageData=e}_reset(){["LOCAL","INT","PRE"].indexOf(this.environment)>-1&&this._logError("Tracking#_reset is a private function, please don't use"),window.pageData=this._pageData=null,W=!1}_submitData(e,t,r){E.__isDnt()?this._log("Tracking: OptOut is enabled, please don't send events"):g.jsonPostRequest(e,t,r)}_trackEvent(e,t){this._submitData(this._ENDPOINT_PAGE_DATA_EVENT,{event:e,payload:t},this._noop),window._satellite.track(e,t)}_queueTrackingEvent(e,t){this._tmsLoadedListenerExists||(document.body.addEventListener("signalLoaded",this._onTmsLoaded.bind(this)),this._tmsLoadedListenerExists=!0),this._trackingQueue.push({event:e,payload:t})}_onTmsLoaded(){this._trackingQueue.forEach(e=>this._trackEvent(e.event,e.payload)),this._trackingQueue=[],this._tmsLoadedListenerExists=!1,document.body.removeEventListener("signalLoaded",this._onTmsLoaded)}_initializeEvents(){W||(W=!0,this.startBatching(),this.__registerGlobalHandlers(),this.onEvent(this._PAGE_DATA_TOPIC,this.__extendPageData.bind(this)),this.onEvent(this._CUSTOM_EVENT_TOPIC,this.__callCustomEvent.bind(this)),this.onEvent(this._PAGE_FINISH_TOPIC,this._appendTagManager.bind(this)),typeof window<"u"&&(g.addEventListener(window,"xrd.track",e=>{let t=e.detail;if(!t.hasOwnProperty("name")||!t.hasOwnProperty("payload")){this._logError("missing 'name' and 'payload' in event's 'detail' property");return}this.trackEvent(t.name,t.payload)}),g.addEventListener(window,"xrd.track-custom",e=>{let t=e.detail;if(!t.hasOwnProperty("name")||!t.hasOwnProperty("payload")){this._logError("missing 'name' and 'payload' in event's 'detail' property");return}this.customEvent(t.name,t.payload)}),g.addEventListener(window,"load",()=>{if(typeof document<"u"&&document.body){let e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",e.style.display="absolute",document.body.appendChild(e),window.setTimeout(()=>{this._adblock=e.offsetHeight===0?1:-1,this._adform=window.Adform?1:-1;try{e.remove()}catch{e.parentNode.removeChild(e)}},10)}})))}},Le=E;var z=class{static get(){let e=[],t="";for(let r=0;r<=15;r++)e[r]=r.toString(16);for(let r=1;r<=36;r++)r===9||r===14||r===19||r===24?t+="-":r===15?t+=4:r===20?t+=e[Math.random()*4|0+8]:t+=e[Math.random()*15|0];return t}},Te=z;function De(n=Te.get){let e=[],t=[],r=!1;return async function(s){let c=new Map,u=[];for(let p of s){if(!Et(p))throw new Error("Please configure your snippets correctly.");let{name:m,namespace:_,query:R,params:P,container:q}=p,ce=n();c.set(ce,typeof q=="string"?document.querySelector(q):q),u.push({id:ce,name:m,namespace:_,query:R,params:P})}let d=window.location&&window.location.origin?window.location.origin:"https://shop.rewe.de",a=await fetch(`${d}/api/frontend-includes`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(u)});if(a.status!==200)throw new Error("Unexpected status code "+a.status+`
Message: `+await a.text());let l=await a.json();r||i(),l.forEach(p=>{let m=c.get(p.id);if(vt(p)){g.triggerEvent(m,"meso.error",p.error);return}let _=[];_.push(...yt(p.styles,e,R=>{let P=document.createElement("link");return P.rel="stylesheet",P.href=R,P})),_.push(...wt(p.scripts,t)),m.replaceChildren(document.createRange().createContextualFragment(p.content)),Promise.all(_).then(()=>g.triggerEvent(m,"meso.injected",{})).catch(R=>g.triggerEvent(m,"meso.error",{message:R.message}))})};function i(){t.push(...Array.from(document.querySelectorAll("script")).map(o=>o.src)),e.push(...Array.from(document.querySelectorAll("link[rel='stylesheet']")).map(o=>o.href)),r=!0}}function vt(n){return n.hasOwnProperty("error")}function yt(n,e,t){return n.filter(r=>!e.includes(r)).map(r=>new Promise((i,o)=>{e.push(r);let s=t(r);s.addEventListener("load",()=>i()),s.addEventListener("error",()=>o(new Error("Error loading "+r)));let c=(document.body||document.getElementsByTagName("head")[0]).childNodes,u=c[c.length-1];u.parentNode.insertBefore(s,u.nextSibling)}))}function wt(n,e){return n.filter(t=>!e.includes(t.src)).map(t=>new Promise((r,i)=>{e.push(t.src);let o=document.createElement("script");if(o.src=t.src,t.extraAttributes)for(let u of t.extraAttributes.split(" ")){let d=u.split("="),a=d[0].replace('"',"").replace('"',""),l="";d.length==2&&(l=d[1].replace('"',"").replace('"',"")),o.setAttribute(a,l)}o.addEventListener("load",()=>r()),o.addEventListener("error",()=>i(new Error("Error loading "+t.src)));let s=(document.body||document.getElementsByTagName("head")[0]).childNodes,c=s[s.length-1];c.parentNode.insertBefore(o,c.nextSibling)}))}function Et(n){return window.__DEBUG&&window.console.info("snippetRequest-Validation: ",n),n.container?typeof n.container!="string"&&n.container&&n.container.nodeType!==Node.ELEMENT_NODE?(window.__DEBUG&&window.console.error("`container` not valid (must be string or node)"),!1):typeof n.container=="string"&&!document.querySelector(n.container)?(window.__DEBUG&&window.console.error(`could not find container-element '${n.container}'`),!1):n.namespace===""||n.name===""?(window.__DEBUG&&window.console.error("expected: namespace and name not to be empty"),!1):!0:(window.__DEBUG&&window.console.error("`container` not set"),!1)}var b,A,ke,x,Y,Fe=-1,L=function(n){addEventListener("pageshow",function(e){e.persisted&&(Fe=e.timeStamp,n(e))},!0)},Z=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},k=function(){var n=Z();return n&&n.activationStart||0},h=function(n,e){var t=Z(),r="navigate";return Fe>=0?r="back-forward-cache":t&&(r=document.prerendering||k()>0?"prerender":document.wasDiscarded?"restore":t.type.replace(/_/g,"-")),{name:n,value:e===void 0?-1:e,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},C=function(n,e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(n)){var r=new PerformanceObserver(function(i){Promise.resolve().then(function(){e(i.getEntries())})});return r.observe(Object.assign({type:n,buffered:!0},t||{})),r}}catch{}},v=function(n,e,t,r){var i,o;return function(s){e.value>=0&&(s||r)&&((o=e.value-(i||0))||i===void 0)&&(i=e.value,e.delta=o,e.rating=function(c,u){return c>u[1]?"poor":c>u[0]?"needs-improvement":"good"}(e.value,t),n(e))}},ee=function(n){requestAnimationFrame(function(){return requestAnimationFrame(function(){return n()})})},F=function(n){var e=function(t){t.type!=="pagehide"&&document.visibilityState!=="hidden"||n(t)};addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0)},te=function(n){var e=!1;return function(t){e||(n(t),e=!0)}},D=-1,Ce=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},j=function(n){document.visibilityState==="hidden"&&D>-1&&(D=n.type==="visibilitychange"?n.timeStamp:0,bt())},Re=function(){addEventListener("visibilitychange",j,!0),addEventListener("prerenderingchange",j,!0)},bt=function(){removeEventListener("visibilitychange",j,!0),removeEventListener("prerenderingchange",j,!0)},ne=function(){return D<0&&(D=Ce(),Re(),L(function(){setTimeout(function(){D=Ce(),Re()},0)})),{get firstHiddenTime(){return D}}},O=function(n){document.prerendering?addEventListener("prerenderingchange",function(){return n()},!0):n()},Pe=[1800,3e3],re=function(n,e){e=e||{},O(function(){var t,r=ne(),i=h("FCP"),o=C("paint",function(s){s.forEach(function(c){c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<r.firstHiddenTime&&(i.value=Math.max(c.startTime-k(),0),i.entries.push(c),t(!0)))})});o&&(t=v(n,i,Pe,e.reportAllChanges),L(function(s){i=h("FCP"),t=v(n,i,Pe,e.reportAllChanges),ee(function(){i.value=performance.now()-s.timeStamp,t(!0)})}))})},Se=[.1,.25],Be=function(n,e){e=e||{},re(te(function(){var t,r=h("CLS",0),i=0,o=[],s=function(u){u.forEach(function(d){if(!d.hadRecentInput){var a=o[0],l=o[o.length-1];i&&d.startTime-l.startTime<1e3&&d.startTime-a.startTime<5e3?(i+=d.value,o.push(d)):(i=d.value,o=[d])}}),i>r.value&&(r.value=i,r.entries=o,t())},c=C("layout-shift",s);c&&(t=v(n,r,Se,e.reportAllChanges),F(function(){s(c.takeRecords()),t(!0)}),L(function(){i=0,r=h("CLS",0),t=v(n,r,Se,e.reportAllChanges),ee(function(){return t()})}),setTimeout(t,0))}))},S={passive:!0,capture:!0},_t=new Date,Ae=function(n,e){b||(b=e,A=n,ke=new Date,He(removeEventListener),Ue())},Ue=function(){if(A>=0&&A<ke-_t){var n={entryType:"first-input",name:b.type,target:b.target,cancelable:b.cancelable,startTime:b.timeStamp,processingStart:b.timeStamp+A};x.forEach(function(e){e(n)}),x=[]}},Lt=function(n){if(n.cancelable){var e=(n.timeStamp>1e12?new Date:performance.now())-n.timeStamp;n.type=="pointerdown"?function(t,r){var i=function(){Ae(t,r),s()},o=function(){s()},s=function(){removeEventListener("pointerup",i,S),removeEventListener("pointercancel",o,S)};addEventListener("pointerup",i,S),addEventListener("pointercancel",o,S)}(e,n):Ae(e,n)}},He=function(n){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return n(e,Lt,S)})},Oe=[100,300],$e=function(n,e){e=e||{},O(function(){var t,r=ne(),i=h("FID"),o=function(u){u.startTime<r.firstHiddenTime&&(i.value=u.processingStart-u.startTime,i.entries.push(u),t(!0))},s=function(u){u.forEach(o)},c=C("first-input",s);t=v(n,i,Oe,e.reportAllChanges),c&&F(te(function(){s(c.takeRecords()),c.disconnect()})),c&&L(function(){var u;i=h("FID"),t=v(n,i,Oe,e.reportAllChanges),x=[],A=-1,b=null,He(addEventListener),u=o,x.push(u),Ue()})})},qe=0,Q=1/0,M=0,Tt=function(n){n.forEach(function(e){e.interactionId&&(Q=Math.min(Q,e.interactionId),M=Math.max(M,e.interactionId),qe=M?(M-Q)/7+1:0)})},Xe=function(){return Y?qe:performance.interactionCount||0},Dt=function(){"interactionCount"in performance||Y||(Y=C("event",Tt,{type:"event",buffered:!0,durationThreshold:0}))},Ne=[200,500],Ge=0,Ie=function(){return Xe()-Ge},y=[],J={},Me=function(n){var e=y[y.length-1],t=J[n.interactionId];if(t||y.length<10||n.duration>e.latency){if(t)t.entries.push(n),t.latency=Math.max(t.latency,n.duration);else{var r={id:n.interactionId,latency:n.duration,entries:[n]};J[r.id]=r,y.push(r)}y.sort(function(i,o){return o.latency-i.latency}),y.splice(10).forEach(function(i){delete J[i.id]})}},Ve=function(n,e){e=e||{},O(function(){Dt();var t,r=h("INP"),i=function(s){s.forEach(function(d){d.interactionId&&Me(d),d.entryType==="first-input"&&!y.some(function(a){return a.entries.some(function(l){return d.duration===l.duration&&d.startTime===l.startTime})})&&Me(d)});var c,u=(c=Math.min(y.length-1,Math.floor(Ie()/50)),y[c]);u&&u.latency!==r.value&&(r.value=u.latency,r.entries=u.entries,t())},o=C("event",i,{durationThreshold:e.durationThreshold||40});t=v(n,r,Ne,e.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),F(function(){i(o.takeRecords()),r.value<0&&Ie()>0&&(r.value=0,r.entries=[]),t(!0)}),L(function(){y=[],Ge=Xe(),r=h("INP"),t=v(n,r,Ne,e.reportAllChanges)}))})},xe=[2500,4e3],K={},We=function(n,e){e=e||{},O(function(){var t,r=ne(),i=h("LCP"),o=function(u){var d=u[u.length-1];d&&d.startTime<r.firstHiddenTime&&(i.value=Math.max(d.startTime-k(),0),i.entries=[d],t())},s=C("largest-contentful-paint",o);if(s){t=v(n,i,xe,e.reportAllChanges);var c=te(function(){K[i.id]||(o(s.takeRecords()),s.disconnect(),K[i.id]=!0,t(!0))});["keydown","click"].forEach(function(u){addEventListener(u,c,!0)}),F(c),L(function(u){i=h("LCP"),t=v(n,i,xe,e.reportAllChanges),ee(function(){i.value=performance.now()-u.timeStamp,K[i.id]=!0,t(!0)})})}})},je=[800,1800],Ct=function n(e){document.prerendering?O(function(){return n(e)}):document.readyState!=="complete"?addEventListener("load",function(){return n(e)},!0):setTimeout(e,0)},ze=function(n,e){e=e||{};var t=h("TTFB"),r=v(n,t,je,e.reportAllChanges);Ct(function(){var i=Z();if(i){var o=i.responseStart;if(o<=0||o>performance.now())return;t.value=Math.max(o-k(),0),t.entries=[i],r(!0),L(function(){t=h("TTFB",0),(r=v(n,t,je,e.reportAllChanges))(!0)})}})};var Qe="/api/xrd",Pt=["mark","measure"],St=["measure"];function Je(n,e,t=ie,r=performance,i=PerformanceObserver){let o={path:n,pageContext:e},s=({duration:u,entryType:d,name:a,startTime:l})=>{a.includes("GTM-")||(d==="mark"&&t({...o,entryType:d,name:a,value:l}),d==="measure"&&t({...o,entryType:d,name:a,value:u}))};r.getEntries().filter(u=>Pt.includes(u.entryType)).forEach(s),new i(function(u,d){u.getEntries().forEach(s)}).observe({entryTypes:St})}function Ke(n,e,t=oe,{onCLS:r,onFID:i,onFCP:o,onLCP:s,onTTFB:c,onINP:u}={onCLS:Be,onFID:$e,onFCP:re,onLCP:We,onTTFB:ze,onINP:Ve}){let d={path:n,pageContext:e};r(({name:a,value:l})=>t({...d,name:a,value:l})),i(({name:a,value:l})=>t({...d,name:a,value:l})),o(({name:a,value:l})=>t({...d,name:a,value:l})),s(({name:a,value:l})=>t({...d,name:a,value:l})),c(({name:a,value:l})=>t({...d,name:a,value:l})),u(({name:a,value:l})=>t({...d,name:a,value:l}))}function ie(n){navigator.sendBeacon(Qe+"/performance",JSON.stringify(n))}function oe(n){navigator.sendBeacon(Qe+"/web-vitals",JSON.stringify(n))}function Ye(n,e){let t=decodeURIComponent(atob(n));document.addEventListener("DOMContentLoaded",()=>Je(t,e,ie)),Ke(t,e,oe)}var se=class{defaultWorkInterval=756;queue=[];timeout=null;httpPostClient;constructor(e){this.httpPostClient=e}add(e){typeof e=="object"&&e!==null&&this.queue.push(e)}len(){return this.queue.length}flushMessages(){if(this.len()>0){let e=this.queue;this.queue=[],this.httpPostClient(e)}}stop(){this.timeout!==null&&(clearInterval(this.timeout),this.timeout=null)}start(){this.timeout===null&&(this.timeout=setInterval(()=>this.flushMessages(),this.defaultWorkInterval))}},Ze=se;function et(n,e){if(At(e))return e;n.warn("Event payload you used is deprecated, new api: https://confluence.rewe-digital.org/pages/viewpage.action?pageId=432775949#FEFrontendIncludes(XRD)-Dispatchingcustomevent%60meso.fetch%60",JSON.stringify(new Error("").stack));let t=[];for(let r of e){if(!Ot(r))throw new Error("Please configure your snippets correctly.");let i=r.snippet.src.split("."),o=i[0],s=i[1];t.push({name:s,namespace:o,container:r.container,query:r.query})}return t}function At(n){for(let e of n)if(!("name"in e&&"namespace"in e&&"container"in e))return!1;return!0}function Ot(n){if(window.__DEBUG&&window.console.info("Snippet-Validation: ",n),!n.container)return window.__DEBUG&&window.console.error("`container` not set"),!1;if(typeof n.container!="string"&&n.container&&n.container.nodeType!==Node.ELEMENT_NODE)return window.__DEBUG&&window.console.error("`container` not valid (must be string or node)"),!1;if(typeof n.container=="string"&&!document.querySelector(n.container))return window.__DEBUG&&window.console.error(`could not find container-element '${n.container}'`),!1;if(!n.snippet||typeof n.snippet!="object")return window.__DEBUG&&window.console.error("`snippet` not set"),!1;if(!n.snippet||!n.snippet.src||typeof n.snippet.src!="string")return window.__DEBUG&&window.console.error("`snippet.src` not set"),!1;let e=n.snippet.src.split("."),t=e[0],r=e[1];return e.length!==2||t===""||r===""?(window.__DEBUG&&window.console.error('expected: snippet.src = "namespace.name" but got '+n.snippet.src),!1):!0}var ae=class{constructor(e="service-name",t,r){this.serviceName=e;this.messageQueue=t;this.window=r;e==="service-name"&&this.window.console.error("Please pass a valid serviceName (as string) to XRD.Logger."),this.forceFlushMessages=!1}entries;forceFlushMessages;_emitLog(e,t=!0){if(typeof e!="object"||e===null){this.window.console.warn("XRD Logger's emitLog must be called with a valid message object.");return}e.message=this.getMessageWithContextData(e.message),this.messageQueue.add(e),t&&this.messageQueue.flushMessages()}buildLogMessage(e,t){return{message:t,level:e,service:this.serviceName}}forceEmit(e){return this.forceFlushMessages=e,this}withField(e,t){return this.entries={...this.entries,[e]:t},this}log(e,t){let r={message:t,level:e,service:this.serviceName,additionalFields:this.entries};this._emitLog(r,this.forceFlushMessages),this.entries={}}debug(e,t=!1){this.window.__DEBUG&&this._emitLog(this.buildLogMessage("DEBUG",e),t)}info(e,t=!1){this._emitLog(this.buildLogMessage("INFO",e),t)}warn(e,t=!1){this._emitLog(this.buildLogMessage("WARN",e),t)}error(e,t=!1){this._emitLog(this.buildLogMessage("ERROR",e),t)}getMessageWithContextData(e){let t=this.window.XRD&&this.window.XRD.contextData||{};t.userAgent=this.window.navigator.userAgent||"unknown";try{let r=JSON.parse(e);return r.contextData=t,JSON.stringify(r)}catch{return e}}},B=ae;var U=class{constructor(e,t){this.messageQueue=e;this.window=t;this.window.addEventListener("xrd.log.debug",r=>this.logEventHandler("DEBUG",r)),this.window.addEventListener("xrd.log.info",r=>this.logEventHandler("INFO",r)),this.window.addEventListener("xrd.log.warn",r=>this.logEventHandler("WARN",r)),this.window.addEventListener("xrd.log.error",r=>this.logEventHandler("ERROR",r))}loggerInstances={};logEventHandler(e,t){let r=t.detail;if(!r.hasOwnProperty("serviceName")||!r.hasOwnProperty("message"))throw new Error("missing 'serviceName' and 'message' in event's 'detail' property");let i=this.getLogger(r.serviceName);switch(e){case"DEBUG":i.debug(r.message);break;case"INFO":default:i.info(r.message);break;case"WARN":i.warn(r.message);break;case"ERROR":i.error(r.message);break}}getLogger(e){return this.loggerInstances[e]||(this.loggerInstances[e]=new B(e,this.messageQueue,this.window)),this.loggerInstances[e]}};var $=new Ze(n=>{fetch("/api/xrd/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})});$.start();g.onError(()=>$.flushMessages());g.onPageHide(()=>$.flushMessages());var tt=new U($,window),H=tt.getLogger("duc-frontend-api"),w={get Utils(){return H.info("Request XRD.Utils:"+new Error().stack,!1),g},get EventEmitter(){return H.info("Request XRD.EventEmitter:"+new Error().stack,!1),de},get Logger(){return H.info("Request XRD.Logger:"+new Error().stack,!1),B}};typeof window<"u"&&window.XRD&&(w=window.XRD);w.version="0.3.23";w.logging=tt;w.Tracking=Le;w.includes={inject:De()};w.performance={measurePerformanceMetrics:Ye};g.addEventListener(document,"meso.fetch",n=>{w.includes.inject(et(H,n.detail))});typeof window<"u"&&(window.XRD=w);var dn=w;})();
